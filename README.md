# 本人工作

二级模块 “调拨控制” 的后端代码

## 申请选择界面

![](https://images.cnblogs.com/cnblogs_com/uoa7/1780821/o_200605040644pharmacy_apply_select.png)

## 申请确认界面

![](https://images.cnblogs.com/cnblogs_com/uoa7/1780821/o_200605040706pharmacy_apply_confirm.png)

# 项目功能结构

| 一级模块     | 二级模块       | 三级模块         | 四级模块                   | 功能说明                                                     |
| ------------ | -------------- | ---------------- | -------------------------- | ------------------------------------------------------------ |
| 登录认证     |                |                  |                            | 用户登录时，对其身份进行认证，根据认证结果跳转到相应界面     |
|              | 查询用户数据库 |                  |                            | 读取用户输入的账号、密码信息，查询用户数据库，若用户提交的账号、密码信息没有匹配，返回空值，若有匹配，返回权限信息 |
|              | 处理查询结果   |                  |                            | 判断查询结果若为空则返回错误页面，否则根据权限信息跳转到对应页面 |
| 基本信息维护 |                |                  |                            | 维护药房的人员信息和摆药信息                                 |
|              | 摆药单维护     |                  |                            | 维护药房摆药信息                                             |
|              |                | 处理医嘱开具请求 |                            | 医嘱(医嘱ID、医嘱类型、时间、医生、药品信息（药品ID、数量、附加信息）) |
|              |                |                  | 查询药品虚库存             | 药房系统收到医嘱开具请求后，查找药品虚库存，当申请量大于当前库存量时，返回库存不足信息。库存足够时发送药品医嘱。虚库存（药品ID，数量） |
|              |                |                  | 存储药品医嘱               | 扣减药品虚库存，并返回成功信息。药品医嘱存入数据库           |
|              | 摆药台维护     |                  |                            | 维护执行单的信息                                             |
|              |                | 生成药品执行单   |                            | 读取医嘱，获取药品id信息，查询医嘱中药品的优先级，进行执行优先级，产生药品执行单 |
|              |                | 打印执行单       |                            | 打印出执行单（药品id、名称，执行顺序）                       |
| 住院退/发药  |                |                  |                            | 管理药房的摆药和退药流程                                     |
|              | 住院摆药管理   |                  |                            | 管理药房的摆药流程                                           |
|              |                | 生成摆药单       |                            | 读取医嘱中摆药单需要显示的数据，生成摆药单（摆药单ID、医嘱ID、药品信息（药品ID、数量、价格）、员工ID、时间） |
|              |                | 打印摆药单       |                            | 打印单据一式两份。摆药单（摆药单ID、医嘱ID、药品信息（药品ID、数量、价格）、员工ID、时间） |
|              | 住院摆药核准   |                  |                            | 确认药品取走，扣除实库存。调用统计查询模块更新工作量。实库存（药品ID，数量） |
|              | 退药管理       |                  |                            | 管理药房的退药流程                                           |
|              |                | 处理退费申请     |                            | 检查是否已超过退费时间限制，如果是，返回不允许退费。如果否，生成退费申请单（单号ID、医生、药品信息（药品ID、数量、价格）、摆药单ID，状态） |
|              |                | 打印退费申请单   |                            | 退费申请单（患者信息、医生信息、所退药品信息（id、名称、数量、价格）） |
|              |                | 退药核对         |                            | 核对药品，更改申请单状态                                     |
| 配置系统     |                |                  |                            | 配置药品标签                                                 |
|              | 采集配置数据   |                  |                            | 判断医嘱类型，筛选打印信息。                                 |
|              | 打印配置标签   |                  |                            | 药品标签（疗程、用法）                                       |
| 统计查询     |                |                  |                            | 统计工作量和盘点信息，根据用户需要，显示相应结果             |
|              | 统计摆药工作量 |                  |                            | 根据员工的摆药核准量，计算工作量                             |
|              | 盘点           |                  |                            | 统计盘点信息                                                 |
|              |                | 打印盘点表       |                            | 读取盘点文件（根据数据库中的盘点表产生），打印文件           |
|              |                | 录入实盘信息     |                            | 处理盘点人员输入的药品id、盘点时间、盘点量、盘点人员信息     |
|              |                | 计算盈亏         |                            | 调用规定的计算方法，计算盈亏                                 |
|              |                | 发送计算结果     |                            | 传送计算出的盈亏结果给会计部门                               |
| 药品调拨     |                |                  |                            | 控制调拨流程，管理入库出库                                   |
|              | 调拨控制       |                  |                            | 控制调拨流程                                                 |
|              |                | 申请药品领药     |                            | 入库单位提交药品申请单。申请单（入库单位，药品信息（ID，数量，当前价格），时间）。接受出库单位的领药申请审批信息，成功时提示已成功申请，否则提示库存不足信息 |
|              |                | 申请退库         |                            | 入库单位发送退库申请给出库单位。若接受到对方同意退库信息，提示申请成功。否则显示对方单位的拒绝信息 |
|              |                | 审批领药申请     |                            | 出库单位检查药品虚库存，当申请量大于当前库存量时，返回库存不足信息。当库存足够，返回成功信息 |
|              |                | 审批退库申请     |                            | 根据约定的规则，若满足则返回同意退库信息，否则返回拒绝信息   |
|              | 入库           |                  |                            | 管理入库流程                                                 |
|              |                | 核准入库         |                            | 根据核准药品的类型，进行相应的数据库操作                     |
|              |                |                  | 查询是否已有药品           | 读取操作人员录入的信息（药品id、核准数量、核准人员、核准时间）中的药品id，若数据库有药品信息返回true，否则返回false |
|              |                |                  | 处理入库药品信息           | 若查询结果为true，更新库存数据库表项；若为false，添加表项    |
|              |                | 打印入库单       |                            | 入库单（入库单位，出库单位，药品信息（ID，数量，当前价格），时间） |
|              |                | 执行退库出库     |                            | 执行和最后一次入库相反的处理                                 |
|              | 出库           |                  |                            | 管理出库流程                                                 |
|              |                | 核准出库         |                            | 生成出库单，扣减虚库存和实库存。                             |
|              |                |                  | 查询出库后药品是否仍有库存 | 读取领药申请中的药品id和数量，若出库后数据库仍有药品信息返回true，否则返回false |
|              |                |                  | 处理出库药品信息           | 若查询结果为true，更新库存数据库表项；若为false，删除表项    |
|              |                | 打印出库单       |                            | 出库单（入库单位，出库单位，药品信息（ID，数量，价格），时间） |
|              |                | 执行退库入库     |                            | 执行和最后一次出库相反的处理                                 |